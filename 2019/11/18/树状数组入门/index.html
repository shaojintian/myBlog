<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="baidu-site-verification" content="PKO0plnZfq" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="邵靳天的小站" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="树状数组详解      先来看几个问题吧。 1.什么是树状数组？ 顾名思义，就是用数组来模拟树形结构呗。那么衍生出一个问题，为什么不直接建树？答案是没必要，因为树状数组能处理的问题就没必要建树。和Trie树的构造方式有类似之处。 2.树状数组可以解决什么问题 可以解决大部分基于区间上的更新以及求和问题。">
<meta property="og:type" content="article">
<meta property="og:title" content="树状数组入门">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2019&#x2F;11&#x2F;18&#x2F;%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E5%85%A5%E9%97%A8&#x2F;index.html">
<meta property="og:site_name" content="邵靳天的小站">
<meta property="og:description" content="树状数组详解      先来看几个问题吧。 1.什么是树状数组？ 顾名思义，就是用数组来模拟树形结构呗。那么衍生出一个问题，为什么不直接建树？答案是没必要，因为树状数组能处理的问题就没必要建树。和Trie树的构造方式有类似之处。 2.树状数组可以解决什么问题 可以解决大部分基于区间上的更新以及求和问题。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https:&#x2F;&#x2F;img2018.cnblogs.com&#x2F;blog&#x2F;1448672&#x2F;201810&#x2F;1448672-20181003121208845-81274925.png">
<meta property="og:image" content="https:&#x2F;&#x2F;img2018.cnblogs.com&#x2F;blog&#x2F;1448672&#x2F;201810&#x2F;1448672-20181003121604644-268531484.png">
<meta property="og:image" content="http:&#x2F;&#x2F;common.cnblogs.com&#x2F;images&#x2F;copycode.gif">
<meta property="og:image" content="http:&#x2F;&#x2F;common.cnblogs.com&#x2F;images&#x2F;copycode.gif">
<meta property="og:image" content="http:&#x2F;&#x2F;common.cnblogs.com&#x2F;images&#x2F;copycode.gif">
<meta property="og:image" content="http:&#x2F;&#x2F;common.cnblogs.com&#x2F;images&#x2F;copycode.gif">
<meta property="og:image" content="http:&#x2F;&#x2F;common.cnblogs.com&#x2F;images&#x2F;copycode.gif">
<meta property="og:image" content="http:&#x2F;&#x2F;common.cnblogs.com&#x2F;images&#x2F;copycode.gif">
<meta property="og:image" content="http:&#x2F;&#x2F;common.cnblogs.com&#x2F;images&#x2F;copycode.gif">
<meta property="og:image" content="http:&#x2F;&#x2F;common.cnblogs.com&#x2F;images&#x2F;copycode.gif">
<meta property="og:updated_time" content="2019-11-18T15:01:22.032Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;img2018.cnblogs.com&#x2F;blog&#x2F;1448672&#x2F;201810&#x2F;1448672-20181003121208845-81274925.png">

<link rel="canonical" href="http://yoursite.com/2019/11/18/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E5%85%A5%E9%97%A8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>树状数组入门 | 邵靳天的小站</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <meta name="baidu-site-verification" content="PKO0plnZfq" />
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">邵靳天的小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">基础设施，后端开发，人工智能</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-guestbook">

    <a href="/guestbook/" rel="section"><i class="fa fa-fw fa-eye"></i>留言板</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/18/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shao Jintian">
      <meta itemprop="description" content="only a geek">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="邵靳天的小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          树状数组入门
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-11-18 22:51:04 / 修改时间：23:01:22" itemprop="dateCreated datePublished" datetime="2019-11-18T22:51:04+08:00">2019-11-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <div id="mainContent">
    <div class="forFlow">
        <div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class="postTitle">

<p><a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/xenny/p/9739600.html" target="_blank" rel="noopener">树状数组详解</a></p>
<div id="cnblogs_post_body" class="blogpost-body ">
    <p><span style="font-size: 14pt;">先来看几个问题吧。</span></p>
<h2 id="autoid-0-0-0">1.什么是树状数组？</h2>
<p><span style="font-size: 14pt;">顾名思义，就是用数组来模拟树形结构呗。那么衍生出一个问题，为什么不直接建树？答案是没必要，因为树状数组能处理的问题就没必要建树。和Trie树的构造方式有类似之处。</span></p>
<h2 id="autoid-0-0-0">2.树状数组可以解决什么问题</h2>
<p><span style="font-size: 14pt;">可以解决大部分基于区间上的更新以及求和问题。</span></p>
<h2 id="autoid-0-0-0">3.树状数组和线段树的区别在哪里</h2>
<p><span style="font-size: 14pt;">树状数组可以解决的问题都可以用线段树解决，这两者的区别在哪里呢？树状数组的系数要少很多，就比如字符串模拟大数可以解决大数问题，也可以解决1+1的问题，但没人会在1+1的问题上用大数模拟。</span></p>
<h2 id="autoid-0-0-0">4.树状数组的优点和缺点</h2>
<p><span style="font-size: 14pt;">修改和查询的复杂度都是O(logN)，而且相比线段树系数要少很多，比传统数组要快，而且容易写。</span></p>
<p><span style="font-size: 14pt;">缺点是遇到复杂的区间问题还是不能解决，功能还是有限。</span></p>
<hr>
<h1 id="autoid-0-0-0">一、树状数组介绍<span style="font-size: 14pt;"><br></span></h1>
<p><span style="font-size: 14pt;">二叉树大家一定都知道，如下图</span></p>
<p><span style="font-size: 14pt;"><img src="https://img2018.cnblogs.com/blog/1448672/201810/1448672-20181003121208845-81274925.png" alt=""></span></p>
<p><span style="font-size: 14pt;">如果每个父亲都存的是两个儿子的值，是不是就可以解决这类区间问题了呢。是的没错，但是这样的树形结构，叫做线段树。</span></p>
<p><span style="font-size: 14pt;">那真的的树形结构是怎样的，和上图类似，但省去了一些节点，以达到用数组建树。</span></p>
<p><span style="font-size: 14pt;"><img src="https://img2018.cnblogs.com/blog/1448672/201810/1448672-20181003121604644-268531484.png" alt=""></span></p>
<p><span style="font-size: 14pt;">黑色数组代表原来的数组（下面用A[i]代替），红色结构代表我们的树状数组(下面用C[i]代替)，发现没有，每个位置只有一个方框，令每个位置存的就是子节点的值的和，则有</span></p>
<ul>
<li><span style="font-size: 14pt;">C[1] = A[1];</span></li>
<li><span style="font-size: 14pt;">C[2] = A[1] + A[2];</span></li>
<li><span style="font-size: 14pt;">C[3] = A[3];</span></li>
<li><span style="font-size: 14pt;">C[4] = A[1] + A[2] + A[3] + A[4];</span></li>
<li><span style="font-size: 14pt;">C[5] = A[5];</span></li>
<li><span style="font-size: 14pt;">C[6] = A[5] + A[6];</span></li>
<li><span style="font-size: 14pt;">C[7] = A[7];</span></li>
<li><span style="font-size: 14pt;">C[8] = A[1] + A[2] + A[3] + A[4] + A[5] + A[6] + A[7] + A[8];</span></li>



</ul>
<p><span style="font-size: 14pt;">可以发现，这颗树是有规律的</span></p>
<p><span style="font-size: 14pt;"><strong>C[i] = A[i - 2<sup>k</sup>+1] + A</strong><span style="font-size: 14pt;"><strong>[i - 2<sup>k</sup>+2] + ... + A[i];&nbsp;&nbsp; //k为i的二进制中从最低位到高位连续零的长度</strong></span></span></p>
<p><span style="font-size: 14pt;"><span style="font-size: 14pt;">例如i = 8(1000)时候，k = 3，可自行验证。<br></span></span></p>
<p><span style="font-size: 14pt;">这个怎么实现求和呢，比如我们要找前7项和，那么应该是</span><span style="font-size: 14pt;">SUM = C[7] + C[6] + C[4];</span></p>
<p><span style="font-size: 14pt;">而根据上面的式子，容易的出<strong>SUM<sub>i</sub> = C[i] + C[i-2<sup>k1</sup>] + C[(i - 2<sup>k1</sup>) - 2<sup>k2</sup>] + .....；</strong></span></p>
<p><span style="font-size: 14pt;">其实树状数组就是一个二进制上面的应用。</span></p>
<p><span style="font-size: 14pt;">现在新的问题来了2^k该怎么求呢，不难得出2^k = i&amp;(i^(i-1));但这个还是不好求出呀，前辈的智慧就出来了，2^k = i&amp;(-i);</span></p>
<p><span style="font-size: 14pt;">为什么呢？</span></p>
<p><span style="font-size: 14pt; color: #008080;">这里利用的负数的存储特性，负数是以补码存储的，对于整数运算 x&amp;(-x)有<br>
&nbsp; &nbsp; &nbsp; &nbsp;<span style="font-size: 14pt; color: #008080;">●</span> 当x为0时，即 0 &amp; 0，结果为0；<br>
&nbsp; &nbsp; &nbsp; &nbsp;●当x为奇数时，最后一个比特位为1，取反加1没有进位，故x和-x除最后一位外前面的位正好相反，按位与结果为0。结果为1。<br>
&nbsp; &nbsp; &nbsp; &nbsp;●当x为偶数，且为2的m次方时，x的二进制表示中只有一位是1（从右往左的第m+1位），其右边有m位0，故x取反加1后，从右到左第有m个0，第m+1位及其左边全是1。这样，x&amp; (-x) 得到的就是x。&nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp;●当x为偶数，却不为2的m次方的形式时，可以写作x= y * (2^k)。其中，y的最低位为1。实际上就是把x用一个奇数左移k位来表示。这时，x的二进制表示最右边有k个0，从右往左第k+1位为1。当对x取反时，最右边的k位0变成1，第k+1位变为0；再加1，最右边的k位就又变成了0，第k+1位因为进位的关系变成了1。左边的位因为没有进位，正好和x原来对应的位上的值相反。二者按位与，得到：第k+1位上为1，左边右边都为0。结果为2^k。<br>
&nbsp; &nbsp; &nbsp; &nbsp; 总结一下：x&amp;(-x)，当x为0时结果为0；x为奇数时，结果为1；x为偶数时，结果为x中2的最大次方的因子。</span></p>
<p><span style="font-size: 14pt; color: #000000;">而且这个有一个专门的称呼，叫做lowbit，即取2^k。</span></p>
<h1 id="autoid-0-0-0"><span style="color: #000000;">二、如何建立树状数组</span></h1>
<p><span style="color: #000000; font-size: 14pt;">上面已经解释了如何用树状数组求区间和，那么如果我们要更新某一个点的值呢，还是一样的，上面说了<span style="font-size: 14pt;"><strong>C[i] = A[i - 2<sup>k</sup>+1] + A</strong><span style="font-size: 14pt;"><strong>[i - 2<sup>k</sup>+2] + ... + A[i]</strong></span></span>，那么如果我们更新某个A[i]的值，则会影响到所有包含有A[i]位置。如果求A[i]包含哪些位置里呢，同理有</span></p>
<p><span style="color: #000000; font-size: 14pt;">A[i] 包含于 C[i + 2<sup>k</sup>]、C[(i + 2<sup>k</sup>) + 2<sup>k</sup>]...；</span></p>
<p>&nbsp;</p>
<p><span style="color: #000000; font-size: 14pt;">好，现在已经搞清楚了更新和求和，就可以来建树状数组了。如果上面的求和、更新或者lowbit步骤还没搞懂的化，建议再思考弄懂再往下看。</span></p>
<p><span style="color: #000000; font-size: 14pt;">那么构造一个树状数组则为</span></p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" target="_blank" rel="noopener" onclick="copyCnblogsCode(this)" title="复制代码"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div>
<pre class="prettyprint prettyprinted" style=""><span style="color: #008080;"><span class="pln"> </span><span class="lit">1</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> n</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">2</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> a</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">1005</span></span><span class="pun">],</span><span class="pln">c</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">1005</span></span><span class="pun">];</span><span class="pln"> </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">对应原数组和树状数组</span></span><span class="pln">
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">3</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">4</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> lowbit</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> x</span><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">5</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">return</span></span><span class="pln"> x</span><span class="pun">&amp;(-</span><span style="color: #000000;"><span class="pln">x</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">6</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">7</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">8</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">void</span></span><span class="pln"> updata</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> i</span><span class="pun">,</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> k</span><span class="pun">){</span><span class="pln">    </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">在i位置加上k</span></span><span class="pln">
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">9</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">while</span></span><span class="pun">(</span><span class="pln">i </span><span class="pun">&lt;=</span><span style="color: #000000;"><span class="pln"> n</span><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">10</span></span><span class="pln">         c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span style="color: #000000;"><span class="pln"> k</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">11</span></span><span class="pln">         i </span><span class="pun">+=</span><span style="color: #000000;"><span class="pln"> lowbit</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">12</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">    </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">13</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">14</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">15</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> getsum</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> i</span><span class="pun">){</span><span class="pln">        </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">求A[1 - i]的和</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">16</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span style="color: #000000;"><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">17</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">while</span></span><span class="pun">(</span><span class="pln">i </span><span class="pun">&gt;</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span style="color: #000000;"><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">18</span></span><span class="pln">         res </span><span class="pun">+=</span><span style="color: #000000;"><span class="pln"> c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">19</span></span><span class="pln">         i </span><span class="pun">-=</span><span style="color: #000000;"><span class="pln"> lowbit</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">20</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">    </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">21</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">return</span></span><span style="color: #000000;"><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">22</span></span><span class="pln"> </span><span class="pun">}</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" target="_blank" rel="noopener" onclick="copyCnblogsCode(this)" title="复制代码"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div>
<p><span style="font-size: 14pt;">这样就构造了一个树状数组。下面看一道模板题目吧。</span></p>
<p><span style="font-size: 14pt;">题目链接：<a href="https://vjudge.net/problem/HDU-1166" target="_blank">https://vjudge.net/problem/HDU-1166</a></span></p>
<p><span style="font-size: 14pt;">直接看代码吧</span></p>
<p>&nbsp;</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" target="_blank" rel="noopener" onclick="copyCnblogsCode(this)" title="复制代码"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div>
<pre class="prettyprint prettyprinted" style=""><span style="color: #008080;"><span class="pln"> </span><span class="lit">1</span></span><span class="pln"> </span><span class="com">#include</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">bits</span><span class="pun">/</span><span class="pln">stdc</span><span class="pun">++.</span><span class="pln">h</span><span class="pun">&gt;</span><span class="pln">
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">2</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">using</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">namespace</span></span><span style="color: #000000;"><span class="pln"> std</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">3</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">4</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> n</span><span class="pun">,</span><span class="pln">m</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">5</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> a</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">50005</span></span><span class="pun">],</span><span class="pln">c</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">50005</span></span><span class="pun">];</span><span class="pln"> </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">对应原数组和树状数组</span></span><span class="pln">
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">6</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">7</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> lowbit</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> x</span><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">8</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">return</span></span><span class="pln"> x</span><span class="pun">&amp;(-</span><span style="color: #000000;"><span class="pln">x</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">9</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">10</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">11</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">void</span></span><span class="pln"> updata</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> i</span><span class="pun">,</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> k</span><span class="pun">){</span><span class="pln">    </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">在i位置加上k</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">12</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">while</span></span><span class="pun">(</span><span class="pln">i </span><span class="pun">&lt;=</span><span style="color: #000000;"><span class="pln"> n</span><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">13</span></span><span class="pln">         c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span style="color: #000000;"><span class="pln"> k</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">14</span></span><span class="pln">         i </span><span class="pun">+=</span><span style="color: #000000;"><span class="pln"> lowbit</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">15</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">    </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">16</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">17</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">18</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> getsum</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> i</span><span class="pun">){</span><span class="pln">        </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">求A[1 - i]的和</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">19</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span style="color: #000000;"><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">20</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">while</span></span><span class="pun">(</span><span class="pln">i </span><span class="pun">&gt;</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span style="color: #000000;"><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">21</span></span><span class="pln">         res </span><span class="pun">+=</span><span style="color: #000000;"><span class="pln"> c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">22</span></span><span class="pln">         i </span><span class="pun">-=</span><span style="color: #000000;"><span class="pln"> lowbit</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">23</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">    </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">24</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">return</span></span><span style="color: #000000;"><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">25</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">26</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">27</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">28</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> t</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">29</span></span><span class="pln">     cin</span><span class="pun">&gt;&gt;</span><span style="color: #000000;"><span class="pln">t</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">30</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">for</span></span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> tot </span><span class="pun">=</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">1</span></span><span class="pun">;</span><span class="pln"> tot </span><span class="pun">&lt;=</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> tot</span><span class="pun">++</span><span style="color: #000000;"><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">31</span></span><span class="pln">         cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span style="color: #800000;"><span class="str">"</span></span><span style="color: #800000;"><span class="str">Case </span></span><span style="color: #800000;"><span class="str">"</span></span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> tot </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span style="color: #800000;"><span class="str">"</span></span><span style="color: #800000;"><span class="str">:</span></span><span style="color: #800000;"><span class="str">"</span></span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span style="color: #000000;"><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">32</span></span><span class="pln">         memset</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span class="pun">,</span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">sizeof</span></span><span style="color: #000000;"><span class="pln"> a</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">33</span></span><span class="pln">         memset</span><span class="pun">(</span><span class="pln">c</span><span class="pun">,</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span class="pun">,</span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">sizeof</span></span><span style="color: #000000;"><span class="pln"> c</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">34</span></span><span class="pln">         cin</span><span class="pun">&gt;&gt;</span><span style="color: #000000;"><span class="pln">n</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">35</span></span><span class="pln">         </span><span style="color: #0000ff;"><span class="kwd">for</span></span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">1</span></span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++</span><span style="color: #000000;"><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">36</span></span><span class="pln">             cin</span><span class="pun">&gt;&gt;</span><span style="color: #000000;"><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">37</span></span><span class="pln">             updata</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]);</span><span class="pln">   </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">输入初值的时候，也相当于更新了值</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">38</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">        </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">39</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">40</span></span><span class="pln">         </span><span style="color: #0000ff;"><span class="kwd">string</span></span><span style="color: #000000;"><span class="pln"> s</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">41</span></span><span class="pln">         </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> x</span><span class="pun">,</span><span class="pln">y</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">42</span></span><span class="pln">         </span><span style="color: #0000ff;"><span class="kwd">while</span></span><span class="pun">(</span><span class="pln">cin</span><span class="pun">&gt;&gt;</span><span class="pln">s </span><span class="pun">&amp;&amp;</span><span class="pln"> s</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">0</span></span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span style="color: #800000;"><span class="str">'</span></span><span style="color: #800000;"><span class="str">E</span></span><span style="color: #800000;"><span class="str">'</span></span><span style="color: #000000;"><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">43</span></span><span class="pln">             cin</span><span class="pun">&gt;&gt;</span><span class="pln">x</span><span class="pun">&gt;&gt;</span><span style="color: #000000;"><span class="pln">y</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">44</span></span><span class="pln">             </span><span style="color: #0000ff;"><span class="kwd">if</span></span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">0</span></span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span style="color: #800000;"><span class="str">'</span></span><span style="color: #800000;"><span class="str">Q</span></span><span style="color: #800000;"><span class="str">'</span></span><span class="pun">){</span><span class="pln">    </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">求和操作</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">45</span></span><span class="pln">                 </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> sum </span><span class="pun">=</span><span class="pln"> getsum</span><span class="pun">(</span><span class="pln">y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> getsum</span><span class="pun">(</span><span class="pln">x</span><span class="pun">-</span><span style="color: #800080;"><span class="lit">1</span></span><span class="pun">);</span><span class="pln">    </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">x-y区间和也就等于1-y区间和减去1-(x-1)区间和</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">46</span></span><span class="pln">                 cout </span><span class="pun">&lt;&lt;</span><span class="pln"> sum </span><span class="pun">&lt;&lt;</span><span style="color: #000000;"><span class="pln"> endl</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">47</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">            </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">48</span></span><span class="pln">             </span><span style="color: #0000ff;"><span class="kwd">else</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">if</span></span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">0</span></span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span style="color: #800000;"><span class="str">'</span></span><span style="color: #800000;"><span class="str">A</span></span><span style="color: #800000;"><span class="str">'</span></span><span style="color: #000000;"><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">49</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">                updata</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">50</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">            </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">51</span></span><span class="pln">             </span><span style="color: #0000ff;"><span class="kwd">else</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">if</span></span><span class="pun">(</span><span class="pln">s</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">0</span></span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span style="color: #800000;"><span class="str">'</span></span><span style="color: #800000;"><span class="str">S</span></span><span style="color: #800000;"><span class="str">'</span></span><span style="color: #000000;"><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">52</span></span><span class="pln">                 updata</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,-</span><span class="pln">y</span><span class="pun">);</span><span class="pln">    </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">减去操作，即为加上相反数</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">53</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">            </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">54</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">        </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">55</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">56</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">    </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">57</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">return</span></span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span style="color: #000000;"><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">58</span></span><span class="pln"> </span><span class="pun">}</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" target="_blank" rel="noopener" onclick="copyCnblogsCode(this)" title="复制代码"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;">这就是最简单的点更新区间求和了。</span></p>
<h1 id="autoid-0-0-0">三、树状数组的几种变式(区间更新，区间查询)</h1>
<p><span style="font-size: 14pt;">上面介绍的是最普通的单点更新，区间查询，但如果有些时候是区间更新，单点求和怎么半，又或是区间更新，区间求和怎么办。这里将介绍各种情况该怎么写。</span></p>
<p><span style="font-size: 14pt;">如果上面的单点更新，区间查询还没看懂，建议再思考再往下看。</span></p>
<h2 id="autoid-0-0-0"><span style="font-size: 14pt;">1.单点更新、单点查询</span></h2>
<p><span style="font-size: 14pt;">传统数组可做</span></p>
<h2 id="autoid-0-0-0"><span style="font-size: 14pt;">2.单点更新、区间查询</span></h2>
<p><span style="font-size: 14pt;">已讲解，详细看上面</span></p>
<h2 id="autoid-0-0-0"><span style="font-size: 14pt;">3.区间更新、单点查询</span></h2>
<p><span style="font-size: 14pt;">这就是第一个问题，如果题目是让你把x-y区间内的所有值全部加上k或者减去k，然后查询操作是问某个点的值，这种时候该怎么做呢。如果是像上面的树状数组来说，就必须把x-y区间内每个值都更新，这样的复杂度肯定是不行的，这个时候，就不能再用数据的值建树了，这里我们引入差分，利用差分建树。</span></p>
<p><span style="font-size: 14pt;">假设我们规定A[0] = 0;</span></p>
<p><span style="font-size: 14pt;">则有 <strong>A[i] = Σ<sup>i</sup><sub>j = 1</sub>D[j];(D[j] = A[j] - A[j-1])，</strong>即前面i项的差值和，这个有什么用呢？例如对于下面这个数组</span></p>
<ul>
<li><span style="font-size: 14pt;">A[] = 1 2 3 5 6 9<br></span></li>
<li><span style="font-size: 14pt;">D[] = 1 1 1 2 1 3</span></li>


</ul>
<p><span style="font-size: 14pt;">如果我们把[2,5]区间内值加上2，则变成了</span></p>
<ul>
<li><span style="font-size: 14pt;">A[] = 1 4 5 7 8 9</span></li>
<li><span style="font-size: 14pt;">D[] = 1 3 <span style="color: #ff0000;">1 2 1</span> 1</span></li>


</ul>
<p><span style="font-size: 14pt;">发现了没有，当某个区间[x,y]值改变了，区间内的差值是不变的，只有D[x]和D[y+1]的值发生改变，至于为什么我想我就不用解释了吧。</span></p>
<p><span style="font-size: 14pt;">所以我们就可以利用这个性质对D[]数组建立树状数组，代码为：</span></p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" target="_blank" rel="noopener" onclick="copyCnblogsCode(this)" title="复制代码"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div>
<pre class="prettyprint prettyprinted" style=""><span style="color: #008080;"><span class="pln"> </span><span class="lit">1</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> n</span><span class="pun">,</span><span class="pln">m</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">2</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> a</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">50005</span></span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="lit">0</span><span class="pun">},</span><span class="pln">c</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">50005</span></span><span class="pun">];</span><span class="pln"> </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">对应原数组和树状数组</span></span><span class="pln">
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">3</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">4</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> lowbit</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> x</span><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">5</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">return</span></span><span class="pln"> x</span><span class="pun">&amp;(-</span><span style="color: #000000;"><span class="pln">x</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">6</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">7</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">8</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">void</span></span><span class="pln"> updata</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> i</span><span class="pun">,</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> k</span><span class="pun">){</span><span class="pln">    </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">在i位置加上k</span></span><span class="pln">
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">9</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">while</span></span><span class="pun">(</span><span class="pln">i </span><span class="pun">&lt;=</span><span style="color: #000000;"><span class="pln"> n</span><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">10</span></span><span class="pln">         c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span style="color: #000000;"><span class="pln"> k</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">11</span></span><span class="pln">         i </span><span class="pun">+=</span><span style="color: #000000;"><span class="pln"> lowbit</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">12</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">    </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">13</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">14</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">15</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> getsum</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> i</span><span class="pun">){</span><span class="pln">        </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">求D[1 - i]的和，即A[i]值</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">16</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span style="color: #000000;"><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">17</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">while</span></span><span class="pun">(</span><span class="pln">i </span><span class="pun">&gt;</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span style="color: #000000;"><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">18</span></span><span class="pln">         res </span><span class="pun">+=</span><span style="color: #000000;"><span class="pln"> c</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">19</span></span><span class="pln">         i </span><span class="pun">-=</span><span style="color: #000000;"><span class="pln"> lowbit</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">20</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">    </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">21</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">return</span></span><span style="color: #000000;"><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">22</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">23</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">24</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">25</span></span><span class="pln">     cin</span><span class="pun">&gt;&gt;</span><span style="color: #000000;"><span class="pln">n</span><span class="pun">;</span></span><span style="color: #008080;"><span class="lit">27</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">for</span></span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">1</span></span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++</span><span style="color: #000000;"><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">28</span></span><span class="pln">         cin</span><span class="pun">&gt;&gt;</span><span style="color: #000000;"><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">29</span></span><span class="pln">         updata</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span class="lit">1</span><span class="pun">]);</span><span class="pln">   </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">输入初值的时候，也相当于更新了值</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">31</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">    </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">32</span></span><span class="pln">     
</span><span style="color: #008080;"><span class="lit">33</span></span><span class="pln">     </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">[x,y]区间内加上k</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">34</span></span><span class="pln">     updata</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln">k</span><span class="pun">);</span><span class="pln">    </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">A[x] - A[x-1]增加k</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">35</span></span><span class="pln">     updata</span><span class="pun">(</span><span class="pln">y</span><span class="pun">+</span><span style="color: #800080;"><span class="lit">1</span></span><span class="pun">,-</span><span class="pln">k</span><span class="pun">);</span><span class="pln">        </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">A[y+1] - A[y]减少k</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">36</span></span><span class="pln">     
</span><span style="color: #008080;"><span class="lit">37</span></span><span class="pln">     </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">查询i位置的值</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">38</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> sum </span><span class="pun">=</span><span style="color: #000000;"><span class="pln"> getsum</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">39</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">40</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">return</span></span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span style="color: #000000;"><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">41</span></span><span class="pln"> </span><span class="pun">}</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" target="_blank" rel="noopener" onclick="copyCnblogsCode(this)" title="复制代码"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div>
<p><span style="font-size: 14pt;">这样就把，原来要更新一个区间的值变成了只需要更新两个点。也很容易理解吧。</span></p>
<h2 id="autoid-0-0-0"><span style="font-size: 14pt;">4.区间更新、区间查询</span></h2>
<p><span style="font-size: 14pt;">上面我们说的差值建树状数组，得到的是某个点的值，那如果我既要区间更新，又要区间查询怎么办。这里我们还是利用差分，由上面可知</span></p>
<p><span style="font-size: 14pt;">∑<sup>n</sup><sub>i = 1</sub>A[i] =&nbsp;<span style="font-size: 14pt;">∑<sup>n</sup><sub>i = 1</sub></span> <span style="font-size: 14pt;"><span style="font-size: 14pt;">∑<sup>i</sup><sub>j = 1</sub>D[j];</span></span></span></p>
<p><span style="font-size: 14pt;"><span style="font-size: 14pt;"><span style="font-size: 14pt;">则</span></span></span>A[1]+A[2]+...+A[n]</p>
<p>&nbsp;</p>
<p>= (D[1]) + (D[1]+D[2]) + ... + (D[1]+D[2]+...+D[n])&nbsp;</p>
<p>&nbsp;</p>
<p>= n*D[1] + (n-1)*D[2] +... +D[n]</p>
<p>&nbsp;</p>
<p>= n * (D[1]+D[2]+...+D[n]) - (0*D[1]+1*D[2]+...+(n-1)*D[n])</p>
<p><span style="font-size: 14pt;">所以上式可以变为<span style="font-size: 14pt;">∑<sup>n</sup><sub>i = 1</sub>A[i] = n*<span style="font-size: 14pt;">∑<sup>n</sup><sub>i = 1</sub>D[i] -&nbsp; <span style="font-size: 14pt;"><span style="font-size: 14pt;">∑<sup>n</sup><sub>i = 1</sub>( D[i]*(i-1) );</span></span></span></span></span></p>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;">如果你理解前面的都比较轻松的话，这里也就知道要干嘛了，维护两个数状数组，sum1[i] = D[i]，sum2[i] = D[i]*(i-1);</span></p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" target="_blank" rel="noopener" onclick="copyCnblogsCode(this)" title="复制代码"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div>
<pre class="prettyprint prettyprinted" style=""><span style="color: #008080;"><span class="pln"> </span><span class="lit">1</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> n</span><span class="pun">,</span><span class="pln">m</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">2</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> a</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">50005</span></span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span style="color: #800080;"><span class="lit">0</span></span><span style="color: #000000;"><span class="pun">};</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">3</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> sum1</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">50005</span></span><span class="pun">];</span><span class="pln">    </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">(D[1] + D[2] + ... + D[n])</span></span><span class="pln">
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">4</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> sum2</span><span class="pun">[</span><span style="color: #800080;"><span class="lit">50005</span></span><span class="pun">];</span><span class="pln">    </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">(1*D[1] + 2*D[2] + ... + n*D[n])</span></span><span class="pln">
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">5</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="pln"> </span><span class="lit">6</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> lowbit</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> x</span><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">7</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">return</span></span><span class="pln"> x</span><span class="pun">&amp;(-</span><span style="color: #000000;"><span class="pln">x</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">8</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="pln"> </span><span class="lit">9</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">10</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">void</span></span><span class="pln"> updata</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> i</span><span class="pun">,</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> k</span><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">11</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span><span class="pln">    </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">因为x不变，所以得先保存i值</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">12</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">while</span></span><span class="pun">(</span><span class="pln">i </span><span class="pun">&lt;=</span><span style="color: #000000;"><span class="pln"> n</span><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">13</span></span><span class="pln">         sum1</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span style="color: #000000;"><span class="pln"> k</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">14</span></span><span class="pln">         sum2</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> k </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x</span><span class="pun">-</span><span style="color: #800080;"><span class="lit">1</span></span><span style="color: #000000;"><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">15</span></span><span class="pln">         i </span><span class="pun">+=</span><span style="color: #000000;"><span class="pln"> lowbit</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">16</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">    </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">17</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">18</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">19</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> getsum</span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> i</span><span class="pun">){</span><span class="pln">        </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">求前缀和</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">20</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span class="pun">,</span><span class="pln"> x </span><span class="pun">=</span><span style="color: #000000;"><span class="pln"> i</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">21</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">while</span></span><span class="pun">(</span><span class="pln">i </span><span class="pun">&gt;</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span style="color: #000000;"><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">22</span></span><span class="pln">         res </span><span class="pun">+=</span><span class="pln"> x </span><span class="pun">*</span><span class="pln"> sum1</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span style="color: #000000;"><span class="pln"> sum2</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">23</span></span><span class="pln">         i </span><span class="pun">-=</span><span style="color: #000000;"><span class="pln"> lowbit</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">24</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">    </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">25</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">return</span></span><span style="color: #000000;"><span class="pln"> res</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">26</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">27</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">28</span></span><span class="pln"> </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span style="color: #000000;"><span class="pln"> main</span><span class="pun">(){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">29</span></span><span class="pln">     cin</span><span class="pun">&gt;&gt;</span><span style="color: #000000;"><span class="pln">n</span><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">30</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">for</span></span><span class="pun">(</span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span style="color: #800080;"><span class="lit">1</span></span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++</span><span style="color: #000000;"><span class="pun">){</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">31</span></span><span class="pln">         cin</span><span class="pun">&gt;&gt;</span><span style="color: #000000;"><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">32</span></span><span class="pln">         updata</span><span class="pun">(</span><span class="pln">i</span><span class="pun">,</span><span class="pln">a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">-</span><span style="color: #800080;"><span class="lit">1</span></span><span class="pun">]);</span><span class="pln">   </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">输入初值的时候，也相当于更新了值</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">33</span></span><span class="pln"> </span><span style="color: #000000;"><span class="pln">    </span><span class="pun">}</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">34</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">35</span></span><span class="pln">     </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">[x,y]区间内加上k</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">36</span></span><span class="pln">     updata</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln">k</span><span class="pun">);</span><span class="pln">    </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">A[x] - A[x-1]增加k</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">37</span></span><span class="pln">     updata</span><span class="pun">(</span><span class="pln">y</span><span class="pun">+</span><span style="color: #800080;"><span class="lit">1</span></span><span class="pun">,-</span><span class="pln">k</span><span class="pun">);</span><span class="pln">        </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">A[y+1] - A[y]减少k</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">38</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">39</span></span><span class="pln">     </span><span style="color: #008000;"><span class="com">//</span></span><span style="color: #008000;"><span class="com">求[x,y]区间和</span></span><span class="pln">
</span><span style="color: #008080;"><span class="lit">40</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">int</span></span><span class="pln"> sum </span><span class="pun">=</span><span class="pln"> getsum</span><span class="pun">(</span><span class="pln">y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> getsum</span><span class="pun">(</span><span class="pln">x</span><span class="pun">-</span><span style="color: #800080;"><span class="lit">1</span></span><span style="color: #000000;"><span class="pun">);</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">41</span></span><span class="pln"> 
</span><span style="color: #008080;"><span class="lit">42</span></span><span class="pln">     </span><span style="color: #0000ff;"><span class="kwd">return</span></span><span class="pln"> </span><span style="color: #800080;"><span class="lit">0</span></span><span style="color: #000000;"><span class="pun">;</span><span class="pln">
</span></span><span style="color: #008080;"><span class="lit">43</span></span><span class="pln"> </span><span class="pun">}</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" target="_blank" rel="noopener" onclick="copyCnblogsCode(this)" title="复制代码"><img src="//common.cnblogs.com/images/copycode.gif" alt="复制代码"></a></span></div></div>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;">再附赠两道模板题目，可以自行写一下以便理解</span></p>
<p><span style="font-size: 14pt;">区间修改、单点查询模板题目：https://www.luogu.org/problem/show?pid=3368<br></span></p>
<p><span style="font-size: 14pt;">区间修改、区间查询模板题目：https://vjudge.net/problem/POJ-3468</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;">PS：这里大致归纳了一维树状数组的所有要使用到的东西，二维建树以及更多变式就不说了，具体问题再具体分析。</span></p>
<hr>
<p>&nbsp;</p>
<p><span style="font-size: 14pt;">后记：<span style="font-family: 楷体;">自己看了一下写的不是很好，特别是公式和图，都是用简单的画图和直接写的，没有用编辑器，也不能说我懒吧，毕竟精力有限啦，以后有空还是会去学的，带给大家更好的博客。手敲也不易，希望大家理解，多多支持。</span></span></p>
<p><span style="font-size: 14pt;"><span style="font-family: 楷体;">不懂问我噢= =</span></span></p>
<p>&nbsp;</p>
</div>
<div id="MySignature"></div>
    </div>

    
    
    

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2019/11/18/%E7%BA%BF%E6%AE%B5%E6%A0%91%E5%85%A5%E9%97%A8-%E4%BE%8B%E9%A2%98/" rel="next" title="线段树入门">
                  <i class="fa fa-chevron-left"></i> 线段树入门
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2019/11/18/%E5%B9%B6%E6%9F%A5%E9%9B%86%E5%85%A5%E9%97%A8/" rel="prev" title="并查集入门">
                  并查集入门 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#topics"><span class="nav-number">1.</span> <span class="nav-text">

树状数组详解

    先来看几个问题吧。
1.什么是树状数组？
顾名思义，就是用数组来模拟树形结构呗。那么衍生出一个问题，为什么不直接建树？答案是没必要，因为树状数组能处理的问题就没必要建树。和Trie树的构造方式有类似之处。
2.树状数组可以解决什么问题
可以解决大部分基于区间上的更新以及求和问题。
3.树状数组和线段树的区别在哪里
树状数组可以解决的问题都可以用线段树解决，这两者的区别在哪里呢？树状数组的系数要少很多，就比如字符串模拟大数可以解决大数问题，也可以解决1+1的问题，但没人会在1+1的问题上用大数模拟。
4.树状数组的优点和缺点
修改和查询的复杂度都是O(logN)，而且相比线段树系数要少很多，比传统数组要快，而且容易写。
缺点是遇到复杂的区间问题还是不能解决，功能还是有限。

一、树状数组介绍
二叉树大家一定都知道，如下图

如果每个父亲都存的是两个儿子的值，是不是就可以解决这类区间问题了呢。是的没错，但是这样的树形结构，叫做线段树。
那真的的树形结构是怎样的，和上图类似，但省去了一些节点，以达到用数组建树。

黑色数组代表原来的数组（下面用A[i]代替），红色结构代表我们的树状数组(下面用C[i]代替)，发现没有，每个位置只有一个方框，令每个位置存的就是子节点的值的和，则有

C[1] = A[1];
C[2] = A[1] + A[2];
C[3] = A[3];
C[4] = A[1] + A[2] + A[3] + A[4];
C[5] = A[5];
C[6] = A[5] + A[6];
C[7] = A[7];
C[8] = A[1] + A[2] + A[3] + A[4] + A[5] + A[6] + A[7] + A[8];




可以发现，这颗树是有规律的
C[i] = A[i - 2k+1] + A[i - 2k+2] + ... + A[i];   //k为i的二进制中从最低位到高位连续零的长度
例如i = 8(1000)时候，k = 3，可自行验证。
这个怎么实现求和呢，比如我们要找前7项和，那么应该是SUM = C[7] + C[6] + C[4];
而根据上面的式子，容易的出SUMi = C[i] + C[i-2k1] + C[(i - 2k1) - 2k2] + .....；
其实树状数组就是一个二进制上面的应用。
现在新的问题来了2^k该怎么求呢，不难得出2^k = i&amp;(i^(i-1));但这个还是不好求出呀，前辈的智慧就出来了，2^k = i&amp;(-i);
为什么呢？
这里利用的负数的存储特性，负数是以补码存储的，对于整数运算 x&amp;(-x)有
       ● 当x为0时，即 0 &amp; 0，结果为0；
       ●当x为奇数时，最后一个比特位为1，取反加1没有进位，故x和-x除最后一位外前面的位正好相反，按位与结果为0。结果为1。
       ●当x为偶数，且为2的m次方时，x的二进制表示中只有一位是1（从右往左的第m+1位），其右边有m位0，故x取反加1后，从右到左第有m个0，第m+1位及其左边全是1。这样，x&amp; (-x) 得到的就是x。 
       ●当x为偶数，却不为2的m次方的形式时，可以写作x= y * (2^k)。其中，y的最低位为1。实际上就是把x用一个奇数左移k位来表示。这时，x的二进制表示最右边有k个0，从右往左第k+1位为1。当对x取反时，最右边的k位0变成1，第k+1位变为0；再加1，最右边的k位就又变成了0，第k+1位因为进位的关系变成了1。左边的位因为没有进位，正好和x原来对应的位上的值相反。二者按位与，得到：第k+1位上为1，左边右边都为0。结果为2^k。
        总结一下：x&amp;(-x)，当x为0时结果为0；x为奇数时，结果为1；x为偶数时，结果为x中2的最大次方的因子。
而且这个有一个专门的称呼，叫做lowbit，即取2^k。
二、如何建立树状数组
上面已经解释了如何用树状数组求区间和，那么如果我们要更新某一个点的值呢，还是一样的，上面说了C[i] = A[i - 2k+1] + A[i - 2k+2] + ... + A[i]，那么如果我们更新某个A[i]的值，则会影响到所有包含有A[i]位置。如果求A[i]包含哪些位置里呢，同理有
A[i] 包含于 C[i + 2k]、C[(i + 2k) + 2k]...；
 
好，现在已经搞清楚了更新和求和，就可以来建树状数组了。如果上面的求和、更新或者lowbit步骤还没搞懂的化，建议再思考弄懂再往下看。
那么构造一个树状数组则为

 1 int n;
 2 int a[1005],c[1005]; //对应原数组和树状数组
 3 
 4 int lowbit(int x){
 5     return x&amp;(-x);
 6 }
 7 
 8 void updata(int i,int k){    //在i位置加上k
 9     while(i &lt;= n){
10         c[i] += k;
11         i += lowbit(i);
12     }
13 }
14 
15 int getsum(int i){        //求A[1 - i]的和
16     int res = 0;
17     while(i &gt; 0){
18         res += c[i];
19         i -= lowbit(i);
20     }
21     return res;
22 }

这样就构造了一个树状数组。下面看一道模板题目吧。
题目链接：https://vjudge.net/problem/HDU-1166
直接看代码吧
 

 1 #include &lt;bits/stdc++.h&gt;
 2 using namespace std;
 3 
 4 int n,m;
 5 int a[50005],c[50005]; //对应原数组和树状数组
 6 
 7 int lowbit(int x){
 8     return x&amp;(-x);
 9 }
10 
11 void updata(int i,int k){    //在i位置加上k
12     while(i &lt;= n){
13         c[i] += k;
14         i += lowbit(i);
15     }
16 }
17 
18 int getsum(int i){        //求A[1 - i]的和
19     int res = 0;
20     while(i &gt; 0){
21         res += c[i];
22         i -= lowbit(i);
23     }
24     return res;
25 }
26 
27 int main(){
28     int t;
29     cin&gt;&gt;t;
30     for(int tot = 1; tot &lt;= t; tot++){
31         cout &lt;&lt; &quot;Case &quot; &lt;&lt; tot &lt;&lt; &quot;:&quot; &lt;&lt; endl;
32         memset(a, 0, sizeof a);
33         memset(c, 0, sizeof c);
34         cin&gt;&gt;n;
35         for(int i = 1; i &lt;= n; i++){
36             cin&gt;&gt;a[i];
37             updata(i,a[i]);   //输入初值的时候，也相当于更新了值
38         }
39 
40         string s;
41         int x,y;
42         while(cin&gt;&gt;s &amp;&amp; s[0] != &#39;E&#39;){
43             cin&gt;&gt;x&gt;&gt;y;
44             if(s[0] == &#39;Q&#39;){    //求和操作
45                 int sum = getsum(y) - getsum(x-1);    //x-y区间和也就等于1-y区间和减去1-(x-1)区间和
46                 cout &lt;&lt; sum &lt;&lt; endl;
47             }
48             else if(s[0] == &#39;A&#39;){
49                 updata(x,y);
50             }
51             else if(s[0] == &#39;S&#39;){
52                 updata(x,-y);    //减去操作，即为加上相反数
53             }
54         }
55 
56     }
57     return 0;
58 }

 
这就是最简单的点更新区间求和了。
三、树状数组的几种变式(区间更新，区间查询)
上面介绍的是最普通的单点更新，区间查询，但如果有些时候是区间更新，单点求和怎么半，又或是区间更新，区间求和怎么办。这里将介绍各种情况该怎么写。
如果上面的单点更新，区间查询还没看懂，建议再思考再往下看。
1.单点更新、单点查询
传统数组可做
2.单点更新、区间查询
已讲解，详细看上面
3.区间更新、单点查询
这就是第一个问题，如果题目是让你把x-y区间内的所有值全部加上k或者减去k，然后查询操作是问某个点的值，这种时候该怎么做呢。如果是像上面的树状数组来说，就必须把x-y区间内每个值都更新，这样的复杂度肯定是不行的，这个时候，就不能再用数据的值建树了，这里我们引入差分，利用差分建树。
假设我们规定A[0] = 0;
则有 A[i] = Σij = 1D[j];(D[j] = A[j] - A[j-1])，即前面i项的差值和，这个有什么用呢？例如对于下面这个数组

A[] = 1 2 3 5 6 9
D[] = 1 1 1 2 1 3



如果我们把[2,5]区间内值加上2，则变成了

A[] = 1 4 5 7 8 9
D[] = 1 3 1 2 1 1



发现了没有，当某个区间[x,y]值改变了，区间内的差值是不变的，只有D[x]和D[y+1]的值发生改变，至于为什么我想我就不用解释了吧。
所以我们就可以利用这个性质对D[]数组建立树状数组，代码为：

 1 int n,m;
 2 int a[50005] = {0},c[50005]; //对应原数组和树状数组
 3 
 4 int lowbit(int x){
 5     return x&amp;(-x);
 6 }
 7 
 8 void updata(int i,int k){    //在i位置加上k
 9     while(i &lt;= n){
10         c[i] += k;
11         i += lowbit(i);
12     }
13 }
14 
15 int getsum(int i){        //求D[1 - i]的和，即A[i]值
16     int res = 0;
17     while(i &gt; 0){
18         res += c[i];
19         i -= lowbit(i);
20     }
21     return res;
22 }
23 
24 int main(){
25     cin&gt;&gt;n;27     for(int i = 1; i &lt;= n; i++){
28         cin&gt;&gt;a[i];
29         updata(i,a[i] - a[i-1]);   //输入初值的时候，也相当于更新了值
31     }
32     
33     //[x,y]区间内加上k
34     updata(x,k);    //A[x] - A[x-1]增加k
35     updata(y+1,-k);        //A[y+1] - A[y]减少k
36     
37     //查询i位置的值
38     int sum = getsum(i);
39 
40     return 0;
41 }

这样就把，原来要更新一个区间的值变成了只需要更新两个点。也很容易理解吧。
4.区间更新、区间查询
上面我们说的差值建树状数组，得到的是某个点的值，那如果我既要区间更新，又要区间查询怎么办。这里我们还是利用差分，由上面可知
∑ni = 1A[i] = ∑ni = 1 ∑ij = 1D[j];
则A[1]+A[2]+...+A[n]
 
= (D[1]) + (D[1]+D[2]) + ... + (D[1]+D[2]+...+D[n]) 
 
= n*D[1] + (n-1)*D[2] +... +D[n]
 
= n * (D[1]+D[2]+...+D[n]) - (0*D[1]+1*D[2]+...+(n-1)*D[n])
所以上式可以变为∑ni = 1A[i] = n*∑ni = 1D[i] -  ∑ni = 1( D[i]*(i-1) );
 
如果你理解前面的都比较轻松的话，这里也就知道要干嘛了，维护两个数状数组，sum1[i] = D[i]，sum2[i] = D[i]*(i-1);

 1 int n,m;
 2 int a[50005] = {0};
 3 int sum1[50005];    //(D[1] + D[2] + ... + D[n])
 4 int sum2[50005];    //(1*D[1] + 2*D[2] + ... + n*D[n])
 5 
 6 int lowbit(int x){
 7     return x&amp;(-x);
 8 }
 9 
10 void updata(int i,int k){
11     int x = i;    //因为x不变，所以得先保存i值
12     while(i &lt;= n){
13         sum1[i] += k;
14         sum2[i] += k * (x-1);
15         i += lowbit(i);
16     }
17 }
18 
19 int getsum(int i){        //求前缀和
20     int res = 0, x = i;
21     while(i &gt; 0){
22         res += x * sum1[i] - sum2[i];
23         i -= lowbit(i);
24     }
25     return res;
26 }
27 
28 int main(){
29     cin&gt;&gt;n;
30     for(int i = 1; i &lt;= n; i++){
31         cin&gt;&gt;a[i];
32         updata(i,a[i] - a[i-1]);   //输入初值的时候，也相当于更新了值
33     }
34 
35     //[x,y]区间内加上k
36     updata(x,k);    //A[x] - A[x-1]增加k
37     updata(y+1,-k);        //A[y+1] - A[y]减少k
38 
39     //求[x,y]区间和
40     int sum = getsum(y) - getsum(x-1);
41 
42     return 0;
43 }

 
再附赠两道模板题目，可以自行写一下以便理解
区间修改、单点查询模板题目：https://www.luogu.org/problem/show?pid=3368
区间修改、区间查询模板题目：https://vjudge.net/problem/POJ-3468
 
PS：这里大致归纳了一维树状数组的所有要使用到的东西，二维建树以及更多变式就不说了，具体问题再具体分析。

 
后记：自己看了一下写的不是很好，特别是公式和图，都是用简单的画图和直接写的，没有用编辑器，也不能说我懒吧，毕竟精力有限啦，以后有空还是会去学的，带给大家更好的博客。手敲也不易，希望大家理解，多多支持。
不懂问我噢= =
 

</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#autoid-0-0-0"><span class="nav-number">1.1.</span> <span class="nav-text">1.什么是树状数组？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#autoid-0-0-0"><span class="nav-number">1.2.</span> <span class="nav-text">2.树状数组可以解决什么问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#autoid-0-0-0"><span class="nav-number">1.3.</span> <span class="nav-text">3.树状数组和线段树的区别在哪里</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#autoid-0-0-0"><span class="nav-number">1.4.</span> <span class="nav-text">4.树状数组的优点和缺点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#autoid-0-0-0"><span class="nav-number">2.</span> <span class="nav-text">一、树状数组介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#autoid-0-0-0"><span class="nav-number">3.</span> <span class="nav-text">二、如何建立树状数组</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#autoid-0-0-0"><span class="nav-number">4.</span> <span class="nav-text">三、树状数组的几种变式(区间更新，区间查询)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#autoid-0-0-0"><span class="nav-number">4.1.</span> <span class="nav-text">1.单点更新、单点查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#autoid-0-0-0"><span class="nav-number">4.2.</span> <span class="nav-text">2.单点更新、区间查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#autoid-0-0-0"><span class="nav-number">4.3.</span> <span class="nav-text">3.区间更新、单点查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#autoid-0-0-0"><span class="nav-number">4.4.</span> <span class="nav-text">4.区间更新、区间查询</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Shao Jintian</p>
  <div class="site-description" itemprop="description">only a geek</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">76</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">湘ICP备19022833号-1 </a>
      <img src="http://www.beian.gov.cn/portal/download" style="display: inline-block;">
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shao Jintian</span>
</div>
  <div class="powered-by">由 <a href="http://beian.miit.gov.cn/" class="theme-link" rel="noopener" target="_blank">hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.5.0
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>













  

  

</body>
</html>
